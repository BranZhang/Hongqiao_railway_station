<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <title>trains</title>
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
        <script src='railway.js'></script>
        <script src='railway_path.js'></script>
        <script src='train.js'></script>
        <!-- <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script> -->
        <!-- <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet'/> -->
        <style>
            body {
                margin: 0;
                padding: 0;
            }

            #map {
                position: absolute;
                top: 0;
                bottom: 0;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <style>
            button {
                position: absolute;
                margin: 20px;
            }

            #pause::after {
                content: 'Pause';
            }

            #pause.pause::after {
                content: 'Play';
            }
        </style>
        <div id='map'></div>
        <button id='pause'></button>
        <script>
            Train.load_railway_data(raw_railway_data);
            Train.load_railway_path_data(railway_path_data);

            var t = new Train("123");
            console.log(t.showName());

            // mapboxgl.accessToken = 'pk.eyJ1IjoiYnJhbnpoYW5nIiwiYSI6ImNrM2U2dHh0ejE2YngzaXFlcjFvdG96b2EifQ.KSQQ0l2qGa1-nrEKn3YKPw';
            // var map = new mapboxgl.Map({
            //     container: 'map',
            //     style: 'mapbox://styles/mapbox/streets-v11',
            //     center: [121.315625, 31.196169],
            //     zoom: 8
            // });

            // var speedFactor = 30;
            // // number of frames per longitude degree
            // var animation;
            // // to store and cancel the animation
            // var startTime = 0;
            // var progress = 0;
            // var pauseButton = document.getElementById('pause');

            // map.on('load', function() {

            //     // add the line which will be modified in the animation
            //     map.addLayer({
            //         'id': 'line-animation',
            //         'type': 'line',
            //         'source': {
            //             'type': 'geojson',
            //             'data': ''
            //         },
            //         'layout': {
            //             'line-cap': 'round',
            //             'line-join': 'round'
            //         },
            //         'paint': {
            //             'line-color': '#ed6498',
            //             'line-width': 5,
            //             'line-opacity': .8
            //         }
            //     });

            //     startTime = performance.now();

            //     animateLine();

            //     // click the button to pause or play
            //     pauseButton.addEventListener('click', function() {
            //         pauseButton.classList.toggle('pause');
            //         if (pauseButton.classList.contains('pause')) {
            //             cancelAnimationFrame(animation);
            //         } else {
            //             resetTime = true;
            //             animateLine();
            //         }
            //     });

            //     // reset startTime and progress once the tab loses or gains focus
            //     // requestAnimationFrame also pauses on hidden tabs by default
            //     document.addEventListener('visibilitychange', function() {
            //         resetTime = true;
            //     });

            //     // animated in a circle as a sine wave along the map.
            //     function animateLine(timestamp) {
            //         if (resetTime) {
            //             // resume previous progress
            //             startTime = performance.now() - progress;
            //             resetTime = false;
            //         } else {
            //             progress = timestamp - startTime;
            //         }

            //         // restart if it finishes a loop
            //         if (progress > speedFactor * 360) {
            //             startTime = timestamp;
            //             geojson.features[0].geometry.coordinates = [];
            //         } else {
            //             var x = progress / speedFactor;
            //             // draw a sine wave with some math.
            //             var y = Math.sin(x * Math.PI / 90) * 40;
            //             // append new coordinates to the lineString
            //             geojson.features[0].geometry.coordinates.push([x, y]);
            //             // then update the map
            //             map.getSource('line-animation').setData(geojson);
            //         }
            //         // Request the next frame of the animation.
            //         animation = requestAnimationFrame(animateLine);
            //     }
            // });
        </script>
    </body>
</html>
